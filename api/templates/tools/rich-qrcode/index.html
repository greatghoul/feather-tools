{% extends "layout.html" %}
{% set url = request.args.get('url', '') %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='rich-qrcode/styles.css') }}">
    <script type="importmap">
    {
        "imports": {
            "qrcode": "https://cdn.jsdelivr.net/npm/qrcode@1.5.4/+esm",
            "axios": "https://cdn.jsdelivr.net/npm/axios@1.9.0/+esm"
        }
    }
    </script>
{% endblock %}

{% block content %}
<h1 class="mb-4">{{ page_name }}</h1>
<p class="lead mb-5">{{ page_note }}</p>

<form id="rich-qrcode-form" class="mb-4">
  <div class="url-input-container">
    <div class="input-group input-group-lg">
      <input type="url" class="form-control form-control-lg" id="url-input" 
        placeholder="https://example.com/" value="{{ url }}" 
        aria-label="URL to create Rich QR code for">
      <button type="submit" class="btn btn-primary" id="fetch-metadata-btn">
        <span class="fetch-btn-text">Fetch</span>
        <span class="spinner-border spinner-border-sm ms-1 d-none" role="status" aria-hidden="true" id="fetch-spinner"></span>
      </button>
    </div>
  </div>
</form>

<div class="row row-gap-4 mb-4">
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header bg-light">
        <h5 class="mb-0">Settings</h5>
      </div>
      <div class="card-body">
        <div class="form-group mb-3">
          <label for="title-input">Title:</label>
          <input type="text" class="form-control" id="title-input" placeholder="Title will appear here">
        </div>
        
        <div class="form-group mb-3">
          <label for="url-display">URL:</label>
          <input type="text" class="form-control" id="url-display" placeholder="https://example.com/">
        </div>
        
        <div class="d-grid gap-2">
          <button type="button" class="btn btn-primary" id="generate-btn">
            <span class="generate-btn-text">Generate QR Code Card</span>
            <span class="spinner-border spinner-border-sm ms-1 d-none" role="status" aria-hidden="true" id="generate-spinner"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header bg-light">
        <h5 class="mb-0">Preview</h5>
      </div>
      <div class="card-body text-center">
        <div class="qrcode-card-container mb-3">
          <canvas id="qrcode-card" width="860" height="120"></canvas>
        </div>
        <div class="text-muted small mb-2">
            <i class="bi bi-info-circle me-1"></i>
            Right click to copy/save the image, or use the download buttons below.
        </div>
        <div class="d-flex justify-content-center mt-3">
          <div class="btn-group">
            <button id="download-png-btn" class="btn btn-outline-success" disabled>
              <i class="bi bi-download me-1"></i> Download PNG
            </button>
            <button id="download-svg-btn" class="btn btn-outline-success" disabled>
              <i class="bi bi-download me-1"></i> Download SVG
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row row-gap-4 mb-4">
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="mb-0">How to Use</h5>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li>Enter the URL you want to generate a Rich QR code for, then click <strong>Fetch</strong> to retrieve metadata.</li>
                    <li>Review or edit the title and URL in the Settings panel.</li>
                    <li>Click <strong>Generate QR Code Card</strong> to preview your QR code card.</li>
                    <li>Right-click the preview image to copy or save, or use the <strong>Download PNG</strong> or <strong>Download SVG</strong> buttons.</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="mb-0">Bookmarklet</h5>
            </div>
            <div class="card-body">
                <p>
                    Drag the button below to your bookmarks bar. When you are on a page you want to generate a Rich QR code for, click the bookmarklet!
                </p>
                <a class="btn btn-outline-primary" href="javascript:(function(){window.open('{{ request.url_root }}rich-qrcode?url='+encodeURIComponent(location.href),'_blank');})();" draggable="true">
                    Rich QRCode
                </a>
                <div class="mt-3 text-muted small">
                    <i class="bi bi-info-circle me-1"></i>
                    This will open the Rich QRCode tool with the current page's URL.
                </div>
            </div>
        </div>
    </div>
</div>

<h5 class="mb-3">You may also like</h5>
<div class="row row-gap-4 mb-4">
    <div class="col-lg-6">
        {% set tool = tools['simple-qrcode'] %}
        {% include 'shared/tool_card.html' %}
    </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='rich-qrcode/main.js') }}" type="module"></script>
{% endblock %}
